# API Gateway è¿‡æ»¤å™¨æ¶æ„é‡æ„è¯´æ˜

## ğŸ¯ é‡æ„ç›®æ ‡
ç»Ÿä¸€è¿‡æ»¤å™¨ç®¡ç†ç»“æ„ï¼Œå®ç°æ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œä¸€è‡´çš„é…ç½®æ¨¡å¼ã€‚

## ğŸ“ é‡æ„åçš„ç›®å½•ç»“æ„

```
api-gateway/src/main/java/com/example/gateway/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ security/                    # å®‰å…¨ç›¸å…³é…ç½®
â”‚   â”‚   â”œâ”€â”€ SecurityConfig.java      # Spring Securityä¸»é…ç½®
â”‚   â”‚   â”œâ”€â”€ FilterConfig.java       # è¿‡æ»¤å™¨Beané…ç½®
â”‚   â”‚   â””â”€â”€ CorsConfig.java         # CORSè·¨åŸŸé…ç½®
â”‚   â”œâ”€â”€ sentinel/                   # é™æµç†”æ–­é…ç½®
â”‚   â”‚   â””â”€â”€ SentinelConfig.java     # Sentinelè§„åˆ™é…ç½®
â”‚   â””â”€â”€ web/                        # Webç›¸å…³é…ç½®ï¼ˆé¢„ç•™ï¼‰
â”œâ”€â”€ filter/
â”‚   â”œâ”€â”€ JwtAuthenticationFilter.java # JWTè®¤è¯è¿‡æ»¤å™¨
â”‚   â”œâ”€â”€ SentinelFilter.java         # Sentinelé™æµè¿‡æ»¤å™¨
â”‚   â””â”€â”€ (å…¶ä»–è¿‡æ»¤å™¨...)
â””â”€â”€ controller/
    â””â”€â”€ ...
```

## ğŸ”§ é‡æ„å†…å®¹

### 1. **FilterConfig.java** - æ–°å¢
- **èŒè´£**: ç»Ÿä¸€ç®¡ç†æ‰€æœ‰è¿‡æ»¤å™¨Beançš„åˆ›å»ºå’Œé…ç½®
- **ä¼˜åŠ¿**:
  - é›†ä¸­ç®¡ç†è¿‡æ»¤å™¨å®ä¾‹
  - ä¾¿äºä¾èµ–æ³¨å…¥å’Œé…ç½®
  - é¿å…åœ¨SecurityConfigä¸­æ··åˆè¿‡æ»¤å™¨åˆ›å»ºé€»è¾‘

### 2. **JwtAuthenticationFilter.java** - ç§»åŠ¨
- **å˜æ›´**: ä» `config` åŒ…ç§»åŠ¨åˆ° `filter` åŒ…
- **åŸå› **: è¿‡æ»¤å™¨åº”è¯¥æ”¾åœ¨filteråŒ…ä¸‹ï¼Œç¬¦åˆSpring Bootçº¦å®š

### 3. **SecurityConfig.java** - ç®€åŒ–
- **å˜æ›´**:
  - ç§»é™¤ç›´æ¥åˆ›å»ºè¿‡æ»¤å™¨å®ä¾‹çš„ä»£ç 
  - é€šè¿‡@Autowiredæ³¨å…¥FilterConfigä¸­çš„Bean
  - ä¸“æ³¨äºå®‰å…¨é…ç½®ï¼Œä¸å†è´Ÿè´£è¿‡æ»¤å™¨åˆ›å»º

### 4. **SentinelFilter.java** - ä¼˜åŒ–
- **å˜æ›´**: ç§»é™¤@Componentæ³¨è§£ï¼Œæ”¹ä¸ºé€šè¿‡FilterConfigç®¡ç†
- **ä¼˜åŠ¿**: ç»Ÿä¸€çš„Beanç®¡ç†æ–¹å¼

## ğŸ—ï¸ æ¶æ„ä¼˜åŠ¿

### 1. **èŒè´£åˆ†ç¦»**
- **config.securityåŒ…**: ç»Ÿä¸€ç®¡ç†å®‰å…¨ç›¸å…³é…ç½®
  - **SecurityConfig**: è´Ÿè´£Spring Securityé…ç½®å’Œè¿‡æ»¤å™¨é“¾ç»„è£…
  - **FilterConfig**: è´Ÿè´£è¿‡æ»¤å™¨Beanåˆ›å»º
  - **CorsConfig**: è´Ÿè´£è·¨åŸŸè®¿é—®é…ç½®
- **config.sentinelåŒ…**: ç»Ÿä¸€ç®¡ç†é™æµç†”æ–­é…ç½®
  - **SentinelConfig**: è´Ÿè´£Sentinelè§„åˆ™é…ç½®
- **filteråŒ…**: è´Ÿè´£å…·ä½“çš„è¿‡æ»¤é€»è¾‘å®ç°

### 2. **ä¸€è‡´æ€§**
- æ‰€æœ‰è¿‡æ»¤å™¨éƒ½é€šè¿‡FilterConfigç»Ÿä¸€ç®¡ç†
- é¿å…äº†æ··åˆçš„Beanåˆ›å»ºæ–¹å¼ï¼ˆæœ‰äº›@Componentï¼Œæœ‰äº›åœ¨Configä¸­åˆ›å»ºï¼‰
- éµå¾ªSpring Bootæœ€ä½³å®è·µ

### 3. **å¯ç»´æŠ¤æ€§**
- æ–°å¢è¿‡æ»¤å™¨åªéœ€åœ¨FilterConfigä¸­æ·»åŠ Beanæ–¹æ³•
- è¿‡æ»¤å™¨å®ç°ç±»ç»Ÿä¸€æ”¾åœ¨filteråŒ…ä¸‹
- é…ç½®é€»è¾‘æ¸…æ™°åˆ†ç¦»

### 4. **å¯æ‰©å±•æ€§**
- ä¾¿äºæ·»åŠ æ–°çš„è¿‡æ»¤å™¨ï¼ˆå¦‚æ—¥å¿—è¿‡æ»¤å™¨ã€ç›‘æ§è¿‡æ»¤å™¨ç­‰ï¼‰
- ä¾¿äºè¿‡æ»¤å™¨çš„å•å…ƒæµ‹è¯•
- ä¾¿äºè¿‡æ»¤å™¨çš„æ¡ä»¶åŒ–é…ç½®

## ğŸ”„ è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº

```
HTTP Request
    â†“
SentinelFilter (é™æµæ£€æŸ¥)
    â†“
JwtAuthenticationFilter (JWTè®¤è¯)
    â†“
å…¶ä»–Spring Securityè¿‡æ»¤å™¨
    â†“
Controller
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### æ·»åŠ æ–°è¿‡æ»¤å™¨çš„æ­¥éª¤ï¼š

1. **åˆ›å»ºè¿‡æ»¤å™¨ç±»**:
```java
// api-gateway/src/main/java/com/example/gateway/filter/RequestLoggingFilter.java
public class RequestLoggingFilter extends OncePerRequestFilter {
    // å®ç°è¿‡æ»¤é€»è¾‘
}
```

2. **åœ¨FilterConfigä¸­æ³¨å†ŒBean**:
```java
@Bean
public RequestLoggingFilter requestLoggingFilter() {
    return new RequestLoggingFilter();
}
```

3. **åœ¨SecurityConfigä¸­é…ç½®è¿‡æ»¤å™¨é“¾**:
```java
.addFilterBefore(requestLoggingFilter, SentinelFilter.class)
```

## ğŸ¯ åˆ†åŒ…æ¶æ„ä¼˜åŠ¿

### 1. **é…ç½®åˆ†ç±»æ¸…æ™°**
- **securityåŒ…**: æ‰€æœ‰å®‰å…¨ç›¸å…³é…ç½®é›†ä¸­ç®¡ç†ï¼ŒåŒ…æ‹¬è®¤è¯ã€æˆæƒã€è·¨åŸŸç­‰
- **sentinelåŒ…**: é™æµç†”æ–­é…ç½®ç‹¬ç«‹ç®¡ç†ï¼Œä¾¿äºæ€§èƒ½è°ƒä¼˜
- **webåŒ…**: é¢„ç•™Webç›¸å…³é…ç½®ï¼Œå¦‚æ‹¦æˆªå™¨ã€è½¬æ¢å™¨ç­‰

### 2. **ä¸»æ¬¡å…³ç³»æ˜ç¡®**
- **ä¸»è¦é…ç½®**: SecurityConfigï¼ˆæ ¸å¿ƒå®‰å…¨é…ç½®ï¼‰
- **è¾…åŠ©é…ç½®**: FilterConfigï¼ˆBeanç®¡ç†ï¼‰ã€CorsConfigï¼ˆè·¨åŸŸæ”¯æŒï¼‰
- **ä¸“é¡¹é…ç½®**: SentinelConfigï¼ˆæ€§èƒ½ä¿æŠ¤ï¼‰

### 3. **æ‰©å±•æ€§å¼º**
- æ–°å¢å®‰å…¨é…ç½®ç›´æ¥æ”¾å…¥securityåŒ…
- æ–°å¢é™æµé…ç½®ç›´æ¥æ”¾å…¥sentinelåŒ…
- ä¾¿äºå›¢é˜Ÿåä½œï¼Œä¸åŒå¼€å‘è€…è´Ÿè´£ä¸åŒåŒ…

### 4. **ç»´æŠ¤ä¾¿åˆ©**
- é—®é¢˜å®šä½å¿«é€Ÿï¼šå®‰å…¨é—®é¢˜æŸ¥securityåŒ…ï¼Œæ€§èƒ½é—®é¢˜æŸ¥sentinelåŒ…
- é…ç½®ä¿®æ”¹å½±å“èŒƒå›´æ˜ç¡®
- ä¾¿äºä»£ç å®¡æŸ¥å’Œé‡æ„

## âœ… éªŒè¯ç»“æœ
- âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
- âœ… è¿‡æ»¤å™¨èŒè´£æ¸…æ™°åˆ†ç¦»
- âœ… é…ç½®ç»“æ„ç»Ÿä¸€ä¸€è‡´ï¼Œåˆ†åŒ…åˆç†
- âœ… ç¬¦åˆSpring Bootæœ€ä½³å®è·µ
- âœ… ä¾¿äºåç»­ç»´æŠ¤å’Œæ‰©å±•
- âœ… é…ç½®ä¸»æ¬¡å…³ç³»æ˜ç¡®ï¼Œä¾¿äºå›¢é˜Ÿåä½œ
